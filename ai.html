
<!-- DO NOT TOUCH!! -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Chatbot</title>
  <link href="https://fonts.googleapis.com/css2?family=Didact+Gothic&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="/ai-styles.css"></link>
  <link rel="prefetch" href="/index.html">

</head>
<body>
  <div class="cursor-dot"></div>
  <div class="cursor-trail"></div>
  <h2>AI Chatbot</h2>
  <p id="date"></p>
  <div class="back" data-page="main360">Home</div>
  <br>
  <div id="chat"></div>
  <div id="input-area">
    <input type="text" id="userInput" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const SUPABASE_URL = "https://yfnwexvsibzqyuqfkepa.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbndleHZzaWJ6cXl1cWZrZXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NDM1MzMsImV4cCI6MjA4MzMxOTUzM30.t_AAtIDD0o7IDN8sUdwdtKxoqFyKdw5n6_-l3e0I-kM" // safe for frontend
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    // Show today's date
    const today = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const currentDate = today.toLocaleDateString('en-US', options);
    document.getElementById('date').innerText = currentDate;

    // Session memory (per tab)
    const chatMemory = [
      { role: "system", content: `You are a helpful AI assistant. Today's date is ${currentDate}. Answer questions using this date.` }
    ];

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const chat = document.getElementById("chat");
      const userMessage = input.value.trim();
      if (!userMessage) return;

      // Show user message
      chat.innerHTML += `<div class="message user">${userMessage}</div>`;
      input.value = "";

      // Show Thinking message
      const thinkingId = "msg-" + Date.now();
      chat.innerHTML += `<div class="message ai" id="${thinkingId}">Thinking...</div>`;
      chat.scrollTop = chat.scrollHeight;

      try {
        // Call Supabase Edge Function
        const { data, error } = await supabase.functions.invoke('hyper-task', {
          body: {
            message: userMessage,
            memory: chatMemory
          }
        });

        if (error) throw error;

        const aiMessage = data?.reply || "No response";

        // Add AI message to session memory
        chatMemory.push({ role: "user", content: userMessage });
        chatMemory.push({ role: "assistant", content: aiMessage });

        // Render Markdown
        document.getElementById(thinkingId).innerHTML = marked.parse(aiMessage);
        chat.scrollTop = chat.scrollHeight;

      } catch (err) {
        document.getElementById(thinkingId).innerText = "Error: " + err.message;
      }
    }

    document.getElementById("sendBtn").addEventListener("click", sendMessage);
    document.getElementById("userInput").addEventListener("keydown", e => {
      if (e.key === "Enter") sendMessage();
    });
    
    document.querySelectorAll(".back").forEach(item => {
      item.onclick = () => {
        window.location.href = "/index.html";
      };
    });
    
    // === Cursor Tracking ===
    const dot = document.querySelector(".cursor-dot");
    const trail = document.querySelector(".cursor-trail");
    let mouseX = 0, mouseY = 0;
    document.addEventListener("mousemove", e => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      dot.style.left = `${mouseX}px`;
      dot.style.top = `${mouseY}px`;
    });
    const animateTrail = () => {
      trail.style.left = `${mouseX}px`;
      trail.style.top = `${mouseY}px`;
      requestAnimationFrame(animateTrail);
    };
    animateTrail();
  </script>
</body>
</html>