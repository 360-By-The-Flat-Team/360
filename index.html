<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>360</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#3b82f6" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="https://codehs.com/uploads/ebf6f06e11ecebae1f0c6f34c0060288" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
    j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-NZHQGS65');
  </script>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NZHQGS65"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Cursor -->
  <div class="cursor-dot" id="cursor-dot"></div>
  <div class="cursor-trail" id="cursor-trail"></div>
  <script>
    const dot = document.getElementById('cursor-dot');
    const trail = document.getElementById('cursor-trail');

    document.addEventListener('mousemove', e => {
      dot.style.left = `${e.clientX}px`;
      dot.style.top = `${e.clientY}px`;
      trail.style.left = `${e.clientX}px`;
      trail.style.top = `${e.clientY}px`;
    });

    document.addEventListener('mousedown', () => {
      dot.classList.add('clicking');
      setTimeout(() => dot.classList.remove('clicking'), 300);
    });
  </script>
  <!-- Sidebar -->
  <button class="sidebar-toggle" id="sidebarToggle">‚ò∞ Menu</button>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header"><br>
      <div id="settingsBtn">‚öôÔ∏è</div>
    </div>
    <nav class="nav-list">
      <div class="nav-item active" data-page="main360">Home</div>
      <div class="nav-item" data-page="ai">AI Chatbot</div>
      <div class="nav-item" data-page="weather">Weather</div>
      <div class="nav-item" data-page="shortener">URL Shortener</div>
      <div class="nav-item" data-page="stocks">Stocks</div>
      <div class="nav-item" data-page="translator">Translator</div>
      <div class="nav-item" data-page="chat">Chat With Others</div>
      <div class="nav-link" onclick="window.location.href='https://games360-17775301.codehs.me'">Play Space Glider</div>
    </nav>
    <footer class="sidebar-footer">360 ¬∑ Flat Inc. ¬∑ 2026</footer>
  </aside>

  <!-- Authentication Buttons -->
  <div id="auth-buttons">
    <button id="open-login-btn">Sign In / Sign Up</button>
    <button id="logout-btn" style="display:none;">Sign Out <span id="logout-label"></span></button>
  </div>

  <!-- Authentication Popup -->
  <div id="auth-popup" class="auth-popup hidden">
    <div class="auth-box">
      <h2>Account Login</h2>
      <input id="auth-email" type="email" placeholder="Email">
      <input id="auth-password" type="password" placeholder="Password">
      <button id="auth-login-btn">Log In</button>
      <button id="auth-signup-btn">Sign Up</button>

      <button id="github-login" class="oauth-btn github">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" />
        <span>Sign in with GitHub</span>
      </button>

      <button id="google-login" class="oauth-btn google">
        <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" />
        <span>Sign in with Google</span>
      </button>

      <p id="auth-error" class="auth-error"></p>
      <button id="auth-close-btn" class="close-btn">Close</button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main">
    <section class="page active" id="page-main360">
      <div class="home-inner">
        <div class="clock-pill">
          <span id="clockTime"></span>
          <small id="clockDate">Loading...</small>
        </div>
        <div class="logo-main"><span>360</span></div>
        <div class="weather-chip"><span>Weather: </span><span id="homeWeatherText">Loading...</span></div>
        <label class="temp-toggle"><input type="checkbox" id="tempToggle"><span class="toggle-text">¬∞C ¬∞F</span></label>
        <div class="search-shell"><div class="gcse-search"></div></div>
        <audio id="clickSound" src="https://codehs.com/uploads/16faab8fd0f7195772f77bcfe0620de7" preload="auto"></audio>
        <audio id="bgMusic" src="https://codehs.com/uploads/67f63271a193390889e0c8567c1ccff4" loop hidden></audio>
        <div id="musicToggle">üîà Music</div>
      </div>
    </section>
    <!-- Weather -->
    <section class="page" id="page-weather">
      <button class="back-btn top-right">‚Üê Back</button>
      <h2>üå¶Ô∏è Weather</h2>
      <form id="weatherForm" class="weather-form">
        <input id="city" placeholder="Enter city..." required />
        <button type="submit">Check</button>
      </form>
      <div id="weatherContent" class="weather-output">Waiting for input...</div>
      <div id="map" class="weather-map"></div>
      <p class="muted">Powered by OpenWeatherMap & OpenStreetMap</p>
    </section>

    <!-- Chat -->
    <section class="page" id="page-chat">
      <button class="back-btn top-right">‚Üê Back</button>
      <h2 style="text-align:center;">360 Chat</h2>
      <div id="chat-window"></div>
      <div id="chat-input-row">
        <input type="text" id="message-input" placeholder="Type your message..." />
        <button id="send-button">Send</button>
      </div>
    </section>

    <!-- AI Chatbot -->
    <section class="page" id="page-ai">
      <button class="back-btn top-right">‚Üê Back</button>
      <h2>AI Chatbot</h2>
      <p id="date"></p>
      <div id="chat"></div>
      <div id="input-area">
        <input type="text" id="userInput" placeholder="Type a message..." />
        <button id="sendBtn">Send</button>
      </div>
    </section>

    <!-- Translator -->
    <section class="page" id="page-translator">
      <button class="back-btn top-right">‚Üê Back</button>
      <h2>360 Translator</h2>
      <div id="translator" style="margin-top:20px">
        <textarea id="translateInput" placeholder="Enter text..." rows="3" style="width:100%"></textarea>
        <div style="margin:10px 0">
          <label>
            <select id="sourceLang">
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="fr">French</option>
              <option value="zh">Mandarin</option>
              <option value="ar">Arabic</option>
            </select>
          </label>
          <label style="margin-left:10px">To:
            <select id="targetLang">
              <option value="es">Spanish</option>
              <option value="en">English</option>
              <option value="fr">French</option>
              <option value="zh">Mandarin</option>
              <option value="ar">Arabic</option>
            </select>
          </label>
          <button id="translateBtn" style="margin-left:10px">Translate</button>
        </div>
        <div id="translateResult" style="white-space:pre-wrap;background:#f0f0f0;padding:10px;border-radius:5px;min-height:40px"></div>
      </div>
    </section>

    <!-- URL Shortener -->
    <section class="page" id="page-shortener">
      <button class="back-btn top-right">‚Üê Back</button>
      <h2>URL Shortener</h2>
      <div class="shortener-box">
        <input id="shortInput" placeholder="Paste URL..." />
        <button id="shortBtn">Shorten</button>
      </div>
      <div id="shortResult">No link yet.</div>
    </section>

    <!-- Stocks -->
    <section class="page" id="page-stocks">
      <button class="back-btn top-right">‚Üê Back</button>
      <h2>üìà Stocks</h2>
      <form id="stockForm">
        <input id="ticker" placeholder="Enter ticker (e.g. AAPL)" required />
        <button type="submit">Check</button>
      </form>
      <div id="quote" class="quote"></div>
    </section>
  </main>
  <!-- Install Button -->
  <button id="installBtn" class="install-banner" style="display:none;">Install 360</button>

  <!-- Supabase Auth Logic -->
  <script>
    const supabase = supabase.createClient(
      'https://wiswfpfsjiowtrdyqpxy.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indpc3dmcGZzamlvd3RyZHlxcHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMzg4OTcsImV4cCI6MjA4MzkxNDg5N30.z_4FtM2c8UwgrRlafPYjolQuod4IoHQats95XHio1zM'
    );

    const openLoginBtn = document.getElementById('open-login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const authPopup = document.getElementById('auth-popup');
    const loginBtn = document.getElementById('auth-login-btn');
    const signupBtn = document.getElementById('auth-signup-btn');
    const closeBtn = document.getElementById('auth-close-btn');
    const errorMsg = document.getElementById('auth-error');

    openLoginBtn.onclick = () => {
      authPopup.classList.remove('hidden');
      errorMsg.textContent = '';
    };
    closeBtn.onclick = () => authPopup.classList.add('hidden');

    loginBtn.onclick = async () => {
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        errorMsg.textContent = error.message;
      } else {
        location.reload();
      }
    };

    signupBtn.onclick = async () => {
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;
      const { error } = await supabase.auth.signUp({ email, password });
      errorMsg.textContent = error ? error.message : "Check your email to confirm your account!";
    };

    document.getElementById('github-login').onclick = async () => {
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: 'github',
        options: { redirectTo: window.location.origin }
      });
      if (error) console.error('GitHub login error:', error.message);
      else if (data?.url) window.location.href = data.url;
    };

    document.getElementById('google-login').onclick = async () => {
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin }
      });
      if (error) console.error('Google login error:', error.message);
      else if (data?.url) window.location.href = data.url;
    };

    logoutBtn.onclick = async () => {
      await supabase.auth.signOut();
      location.reload();
    };

    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session) {
        logoutBtn.style.display = 'inline-block';
        openLoginBtn.style.display = 'none';
        const email = session.user.email;
        const label = document.getElementById('logout-label');
        if (label) label.textContent = `(${email})`;
      }
    });
  </script>

  <!-- Your App Logic -->
  <script src="script.js"></script>
</body>
</html>
